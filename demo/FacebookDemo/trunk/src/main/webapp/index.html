<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
  <title>Facebook Connect Demo 1</title>
  <style type="text/css">
    @import "js/dojo-1.1.1/dojo/resources/dojo.css";
    @import "js/dojo-1.1.1/dojox/grid/_grid/tundraGrid.css";
    @import "js/dojo-1.1.1/dijit/themes/tundra/tundra.css";
    
    html, body, .mainDiv {
      width: 100%;
      height: 100%;
      padding: 0;
      border: 0;
      margin: 0;
    }
    
    .userbox {
      vertical-align: middle;
    }
  </style>

  <!-- Dojo import -->
  <script type="text/javascript"
          src="js/dojo-1.1.1/dojo/dojo.js"
          djConfig="parseOnLoad: true, modulePaths: {org: '../../org'}, isDebug: false">
  </script>
  
  <script type="text/javascript">
    dojo.require("dojo.parser");
    dojo.require("dijit.layout.BorderContainer");
    dojo.require("dijit.layout.ContentPane");
    dojo.require("dijit.form.Button");
    dojo.require("dijit.form.TextBox");
    dojo.require("org.ppwcode.dojo.dijit.form.PpwMasterView");
    dojo.require("org.ppwcode.dojo.dojox.grid.data.model");
    dojo.require("org.ppwcode.dojo.dijit.form.PpwCrudForm");
    dojo.require("org.ppwcode.dojo.dijit.form.PpwImageBox");
  </script>
  
  <script type="text/javascript">
  var friendsgridview = {
	        cells: [
	          [
	            {name: "First Name", field: "first_name", width: "8em"},
	            {name: "Last Name", field: "last_name", width: "100%"}
	          ]
	        ]
	};
	var friendsgridlayout = [ friendsgridview ];
  var friendsgridmodel = new org.ppwcode.dojo.dojox.grid.data.PpwObjects();

  var fbFriendFormMap = [
      { property: "pic", fieldid: "FbFriendPicture", isEditable: false},
      { property: "first_name", fieldid: "FbFriendFirstName", isEditable: false},
      { property: "last_name", fieldid: "FbFriendLastName", isEditable: false}
  ];
  dojo.addOnLoad(function() {
     fbFriendForm.setFormMap(fbFriendFormMap);
  });
  </script>
  
  <!--  FACEBOOK code -->
  <script type="text/javascript">
    function show_user() {
       var node = document.getElementById("userbox");
       node.innerHTML = 
             "<table>"
           + "  <tbody><tr>"
           + "    <td>"
           + "      <fb:profile-pic uid='loggedinuser' facebook-logo='true'></fb:profile-pic>"
           + "    </td><td>"
           + "      <span>Welcome, <fb:name uid='loggedinuser' useyou='false'></fb:name>.  You are signed in with"
           + "      your facebook account. <button dojoType='dijit.form.Button' onclick='do_logout();'>logout</logout></span>"
           + "    </td>"
           + "  </tr></tbody>"
           + "</table>"
       FB.XFBML.Host.parseDomTree();
       dojo.parser.parse(node);
    }

    function retrieve_friends() {
        FB.Facebook.apiClient.friends_get(null, function(result, ex) {

            FB.Facebook.apiClient.users_getInfo(result, ["pic", "first_name", "last_name"], function(result2, ex2) {
                friendsgridmodel.setData(result2);
            });
          });
    }
    
    function do_login() {
      show_user();
      retrieve_friends()
    }
    
    function do_logout() {
        fbMasterView.clear();
        FB.Connect.logout(function() {
            var node = document.getElementById("userbox");
            node.innerHTML = "<fb:login-button onlogin='show_user();'></fb:login-button>";
            FB.XFBML.Host.parseDomTree();
        });
    }
  </script>
</head>

<body class="tundra">
  <div class="mainDiv" dojoType="dijit.layout.BorderContainer" design="headline" liveSplitters="true" gutters="true">
    <div dojoType="dijit.layout.ContentPane" region="top" splitter="false" style="height: 60px;">
      <div id="userbox" class="userbox">
        <fb:login-button onlogin="do_login();"></fb:login-button>
      </div>
    </div>
    <div dojoType="dijit.layout.ContentPane" region="left" splitter="true" style="width: 350px;">
      <div id="fbMasterView" jsId="fbMasterView" dojoType="org.ppwcode.dojo.dijit.form.PpwMasterView" gridModel="friendsgridmodel" gridStructure="friendsgridlayout">
        <script type="dojo/method" event="onGridRowClick">
          fbFriendForm.displayItem(fbMasterView.getSelectedItem());
        </script>
        <script type="dojo/method" event="onGridHeaderClick">
          fbFriendForm.reset();
        </script>
        <script type="dojo/method" event="onClearSelection">
          fbFriendForm.reset();
        </script>
        <script type="dojo/method" event="onClear">
          fbFriendForm.reset();
        </script>
        <script type="dojo/method" event="onSetData">
          fbFriendForm.reset();
        </script>
      </div>
    </div>
    <div dojoType="dijit.layout.ContentPane" region="center" splitter="true">
      <form id="fbFriendForm" jsId="fbFriendForm" dojoType="org.ppwcode.dojo.dijit.form.PpwCrudForm">
        <table>
          <tbody>
            <tr>
              <td style="width: 100px; padding: 2px; text-align: center; vertical-align: top;">
               <span id="FbFriendPicture" dojoType="org.ppwcode.dojo.dijit.form.PpwImageBox"></span>
              </td>
              <td style="vertical-align: top;">
                <div>
                  <label>First Name</label><br/>
                  <div style="height: 4ex;">
                    <input id="FbFriendFirstName" dojoType="dijit.form.TextBox"></input>
                  </div>
                </div>
                <div>  
                  <label>Last Name</label><br/>
                  <input id="FbFriendLastName" dojoType="dijit.form.TextBox"></input>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>
  </div>
  
  
  <script src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php" type="text/javascript"></script>
  <script type="text/javascript">
    FB.init("c77ef4b86b5c5442c67898ba963d8735", "xd_receiver.htm");
    FB.ensureInit(function() {
        FB.Connect.ifUserConnected(do_login);
    });  
  </script>
</body>
</html>
